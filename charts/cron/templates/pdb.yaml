{{- $workers := .Values.tfjob.workers -}}
{{- $ps := .Values.tfjob.ps -}}
{{- $chief := .Values.tfjob.chief -}}
{{- $evaluator := .Values.tfjob.evaluator -}}
{{- $total := .Values.tfjob.total -}}
{{- if .Values.tfjob.ps }}
{{- if .Values.tfjob.hasGangScheduler }}
{{- if .Values.tfjob.enableGangScheduler }}
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  name: {{ .Release.Name }}
  labels:
    app: {{ template "tfjob.name" . }}
    chart: {{ template "tfjob.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
{{- if .Values.tfjob.chief }}
  minAvailable: {{ add $workers $ps $chief $evaluator }}
{{- else }}
  minAvailable: {{ add $workers $ps }}
{{- end }}
  selector:
    matchLabels:
      tf-job-name: {{ .Release.Name }}
{{- end }}
{{- end }}
{{- end }}